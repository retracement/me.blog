<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
  

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" type="image/png" href="https://tenbulls.co.uk/favicon.ico" />
<meta property="og:url" content="https://tenbulls.co.uk/posts/2018/08/01/loading-and-using-sql-server-management-objects-in-powershell/">
  <meta property="og:site_name" content="tenbulls blog">
  <meta property="og:title" content="Loading and using SQL Server Management Objects in PowerShell">
  <meta property="og:description" content="I recently came across a snippet of code I had written for a client several years ago – one of those “by the way, how would you do this” type of requests. On the face of it, the task at hand seemed fairly simple to deliver since they wanted to query SQL Server Agent jobs through PowerShell. But because they also wanted to be able to change the SQL Server Agent jobs using PowerShell, I decided that the simplest way would be to programmatically access these jobs as Objects thereby providing Methods to call and Properties that can be easily returned or changed through their get and set accessors.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2018-08-01T17:37:00+01:00">
    <meta property="article:modified_time" content="2018-08-01T17:37:00+01:00">
    <meta property="article:tag" content="PowerShell">
    <meta property="article:tag" content="SMO">
    <meta property="article:tag" content="SQL">
    <meta property="article:tag" content="Dotnet">

<title>tenbulls blog | Loading and using SQL Server Management Objects in PowerShell</title>

      <link rel="stylesheet" href="/css/main.min.9c8fd37ab394163a75f3b9f19662b76ee3aa3538a20e35f5c0abe36f677c8302.css" integrity="sha256-nI/TerOUFjp187nxlmK3buOqNTiiDjX1wKvjb2d8gwI=" crossorigin="anonymous">
        <link rel="stylesheet" href="/css/palette/default.min.98db41a18eb278705557b678b4ad23b154f0f60e0dc69d3672f24207a951505b.css" integrity="sha256-mNtBoY6yeHBVV7Z4tK0jsVTw9g4Nxp02cvJCB6lRUFs=" crossorigin="anonymous">

      <script src="/js/main.86bb3d8e6f46df0fc97c2731e6b99175a13b87a4086acf578ff9b6992fcf32c1.js" integrity="sha256-hrs9jm9G3w/JfCcx5rmRdaE7h6QIas9Xj/m2mS/PMsE=" crossorigin="anonymous"></script>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

</head>

<body
    class="dark"
>
  
  <main>
    
  <div class="container pt-5">
    <div class="row mt-5 pt-5">
      
  <nav aria-label="breadcrumb" class="small navbar navbar-expand-lg">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleMenu" aria-controls="collapsibleMenu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse mt-3 mt-md-0" id="collapsibleMenu">
      <ol class="breadcrumb fw-bold">
    <li class="breadcrumb-item my-1 my-md-0 ms-3 ms-md-0">
      <a href="/about"
        
      >about</a>
      
    </li>
    <li class="breadcrumb-item my-1 my-md-0 ms-3 ms-md-0">
      <a href="/"
        
      >home</a>
      
    </li>
    <li class="breadcrumb-item my-1 my-md-0 ms-3 ms-md-0">
      <a href="https://www.meetup.com/hybrid-virtual-group/"
        
          target="_blank" rel="noopener noreferrer"
        
      >meetup</a>
      
    </li>
    <li class="breadcrumb-item my-1 my-md-0 ms-3 ms-md-0">
      <a href="/posts"
        class="text-decoration-underline link-offset-3"
        
      >posts</a>
      
    </li>
    <li class="breadcrumb-item my-1 my-md-0 ms-3 ms-md-0">
      <a href="/tags"
        
      >tags</a>
      
    </li>
      </ol>
    </div>
  </nav>

    </div>
    <div class="post">
      <header class="mb-4">
        <h1 class="text-uppercase">Loading and using SQL Server Management Objects in PowerShell</h1>
        
        
        <div aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item small">
              
              <time datetime="2018-08-01T17:37:00&#43;01:00">August 1, 2018</time>
            </li>
            
            
            <li class="breadcrumb-item small">
              3 minutes
            </li>
          </ol>
        </div>
      </header>
      
      <article>
        <p>I recently came across a snippet of code I had written for a client several years ago – one of those &ldquo;by the way, how would you do this&rdquo; type of requests. On the face of it, the task at hand seemed fairly simple to deliver since they wanted to query SQL Server Agent jobs through PowerShell. But because they also wanted to be able to change the SQL Server Agent jobs using PowerShell, I decided that the simplest way would be to programmatically access these jobs as Objects thereby providing <em>Methods</em> to call and <em>Properties</em> that can be easily returned or changed through their <em>get</em> and <em>set</em> accessors.</p>
<p>It was a no brainer that I would need to use <a href="https://docs.microsoft.com/en-us/sql/relational-databases/server-management-objects-smo/sql-server-management-objects-smo-programming-guide">SQL Server Management Objects</a> (SMO) through PowerShell. In this post I will explain how to use SQL Server Management Objects in PowerShell.</p>
<h1 id="loading-sql-server-management-objects">Loading SQL Server Management Objects</h1>
<p>First, we need to talk about how to load the SMO assembly into the PowerShell session&hellip;</p>
<p><strong>Method 0, Using sqlps</strong></p>
<p>If we are going to use <code>sqlps</code> then we can go straight to the code since this automatically loads the SMO assembly into the sqlps session. You can do this by either importing the sqlps module into your PowerShell session:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>Import-Module sqlps
</span></span></code></pre></div><p>Or simply enter a sqlps session from your PowerShell session by running that command from the command line:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sqlps
</span></span></code></pre></div><p>Otherwise, we need do this using one of the following methods.</p>
<p><strong>Method 1, Using Reflection</strong>
This method is generally considered the older way of doing this, though I personally think it is the simplest and probably less prone to issues.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>[<span style="color:#66d9ef">reflection.assembly</span>]::LoadWithPartialName(<span style="color:#e6db74">&#34;Microsoft.SqlServer.Smo&#34;</span>)
</span></span></code></pre></div><p>However, you might want to visit the Microsoft Docs page for <a href="https://docs.microsoft.com/en-us/dotnet/api/system.reflection.assembly.loadwithpartialname">Assembly.LoadWithPartialName Method</a> and take note of the warning pane stating that:</p>
<blockquote>
<p>This API is now obsolete</p>
</blockquote>
<p>This is referring explicitly to both method overloads of <code>LoadWithPartialName(String)</code> and <code>LoadWithPartialName(String, Evidence)</code>. So I suppose it is fair to say to avoid using this technique in the future.</p>
<p><strong>Method 2, Using Add-Type</strong></p>
<p>If you are using PowerShell 3.0 or above (which at the time of writing is probably nearly everyone since it was introduced in Windows Server 2012) we can use the <code>Add-Type</code> cmdlet.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>Add-Type -AssemblyName `
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;Microsoft.SqlServer.Smo,Version=14.0.0.0,Culture=neutral,PublicKeyToken=89845dcd8080cc91&#34;</span>
</span></span></code></pre></div><p>You might be wondering which Smo version you should be using? You can find out what is installed by looking in the GAC at <code>C:\Windows\assembly\GAC_MSIL\Microsoft.SqlServer.Smo</code></p>
<p><img src="/images/2018/smo_gac.jpg" alt="SMO GAC"></p>
<p>In my case, I have a single instance of SQL Server 2016 installed but have four versions of SMO available. Whilst all four will technically work, it is possible functionality/ performance may be limited between versions, so we use the most recent (14.0.0.0).</p>
<p>As a final point, you can query your loaded assemblies for your session using the following command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>[<span style="color:#66d9ef">System.AppDomain</span>]::CurrentDomain.GetAssemblies()
</span></span></code></pre></div><p>It is interesting (if nothing else) to try this after attempting each method listed above to see how each app domain differs.</p>
<p>Ok. So once we have SMO available we can start consuming it. First up, we will instantiate an object to our SQL Server instance.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>$sqlinstance = New-Object `
</span></span><span style="display:flex;"><span>   -TypeName Microsoft.SQLServer.Management.Smo.Server(<span style="color:#e6db74">&#34;server2\sql2016&#34;</span>)
</span></span></code></pre></div><p>Please note that you will not see an error or exception if the instance is not found. Instead, you could access one of the main properties to test existence for a value. For example, if we query the Product property, we should see &ldquo;Microsoft SQL Server&rdquo;, otherwise that field will be blank.</p>
<p>Finally, to see what methods and properties are available we can view the public object class members as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>$sqlinstance|Get-Member
</span></span></code></pre></div><p>Thankfully we can also see which properties have been defined with a read accessor (get) or write accessor (set) or both (get;set).</p>
<p><img src="/images/2018/psgmaccessors.jpg" alt="Get/Set accessors"></p>
<hr>
<p>In my next post titled <a href="/posts/2018/08/02/manipulating-sql-agent-jobs-through-powershell">Manipulating SQL Agent Jobs through PowerShell</a> I will explain how to manipulate SQL Server Agent jobs using PowerShell and SQL Server Management Objects.</p>

      </article>
      
  <div class="tags pb-4 pt-2">
    
    
        <a class="badge rounded-pill text-uppercase text-bg-secondary" href="/tags/powershell/">PowerShell</a>
        <a class="badge rounded-pill text-uppercase text-bg-secondary" href="/tags/smo/">SMO</a>
        <a class="badge rounded-pill text-uppercase text-bg-secondary" href="/tags/sql/">SQL</a>
        <a class="badge rounded-pill text-uppercase text-bg-secondary" href="/tags/dotnet/">Dotnet</a>
  </div>

      <div class="row">
    <div class="col-md">
        
        <a href="https://tenbulls.co.uk/posts/2018/03/14/reading-big-text-files-using-ps/">
            <span>previous: </span>
            <span>Reading very BIG text files using PowerShell</span>
        </a>
        
    </div>
    <div class="col-md text-md-end">
        
        <a href="https://tenbulls.co.uk/posts/2018/08/02/manipulating-sql-agent-jobs-through-powershell/">
            <span>next: </span>
            <span>Manipulating SQL Agent Jobs through PowerShell</span>
        </a>
        
    </div>
</div>
      
    </div>
  </div>
  <footer>
    <div class="container mt-4 pb-1">
    <p class="small opacity-75">
        Copyright © 2026 Mark Broadbent
        
    </p>
</div>

  </footer>

  </main>

  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>
