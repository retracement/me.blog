<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
  

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" type="image/png" href="https://tenbulls.co.uk/favicon.ico" />
<meta property="og:url" content="https://tenbulls.co.uk/posts/2018/08/02/manipulating-sql-agent-jobs-through-powershell/">
  <meta property="og:site_name" content="tenbulls blog">
  <meta property="og:title" content="Manipulating SQL Agent Jobs through PowerShell">
  <meta property="og:description" content="In our last post titled Loading and using SQL Server Management Objects in PowerShell, we demonstrated how to load and consume SQL Server Management Objects in PowerShell, which then allows us to access your SQL instance through an SMO instance object. Please make sure you read that post before continuing.
In this specific post, we will demonstrate and walk through how to use PSH and SMO to view and change SQL Agent jobs.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2018-08-02T12:14:00+01:00">
    <meta property="article:modified_time" content="2018-08-02T12:14:00+01:00">
    <meta property="article:tag" content="PowerShell">
    <meta property="article:tag" content="SMO">
    <meta property="article:tag" content="SQL">
    <meta property="article:tag" content="Dotnet">

<title>tenbulls blog | Manipulating SQL Agent Jobs through PowerShell</title>

      <link rel="stylesheet" href="/css/main.min.9c8fd37ab394163a75f3b9f19662b76ee3aa3538a20e35f5c0abe36f677c8302.css" integrity="sha256-nI/TerOUFjp187nxlmK3buOqNTiiDjX1wKvjb2d8gwI=" crossorigin="anonymous">
        <link rel="stylesheet" href="/css/palette/default.min.98db41a18eb278705557b678b4ad23b154f0f60e0dc69d3672f24207a951505b.css" integrity="sha256-mNtBoY6yeHBVV7Z4tK0jsVTw9g4Nxp02cvJCB6lRUFs=" crossorigin="anonymous">

      <script src="/js/main.86bb3d8e6f46df0fc97c2731e6b99175a13b87a4086acf578ff9b6992fcf32c1.js" integrity="sha256-hrs9jm9G3w/JfCcx5rmRdaE7h6QIas9Xj/m2mS/PMsE=" crossorigin="anonymous"></script>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

</head>

<body
    class="dark"
>
  
  <main>
    
  <div class="container pt-5">
    <div class="row mt-5 pt-5">
      
  <nav aria-label="breadcrumb" class="small navbar navbar-expand-lg">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleMenu" aria-controls="collapsibleMenu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse mt-3 mt-md-0" id="collapsibleMenu">
      <ol class="breadcrumb fw-bold">
    <li class="breadcrumb-item my-1 my-md-0 ms-3 ms-md-0">
      <a href="/about"
        
      >about</a>
      
    </li>
    <li class="breadcrumb-item my-1 my-md-0 ms-3 ms-md-0">
      <a href="/"
        
      >home</a>
      
    </li>
    <li class="breadcrumb-item my-1 my-md-0 ms-3 ms-md-0">
      <a href="https://www.meetup.com/hybrid-virtual-group/"
        
          target="_blank" rel="noopener noreferrer"
        
      >meetup</a>
      
    </li>
    <li class="breadcrumb-item my-1 my-md-0 ms-3 ms-md-0">
      <a href="/posts"
        class="text-decoration-underline link-offset-3"
        
      >posts</a>
      
    </li>
    <li class="breadcrumb-item my-1 my-md-0 ms-3 ms-md-0">
      <a href="/tags"
        
      >tags</a>
      
    </li>
      </ol>
    </div>
  </nav>

    </div>
    <div class="post">
      <header class="mb-4">
        <h1 class="text-uppercase">Manipulating SQL Agent Jobs through PowerShell</h1>
        
        
        <div aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item small">
              
              <time datetime="2018-08-02T12:14:00&#43;01:00">August 2, 2018</time>
            </li>
            
            
            <li class="breadcrumb-item small">
              3 minutes
            </li>
          </ol>
        </div>
      </header>
      
      <article>
        <p>In our last post titled <a href="/posts/2018/08/01/loading-and-using-sql-server-management-objects-in-powershell">Loading and using SQL Server Management Objects in PowerShell</a>, we demonstrated how to load and consume SQL Server Management Objects in PowerShell, which then allows us to access your SQL instance through an SMO instance object. Please make sure you read that post before continuing.</p>
<p>In this specific post, we will demonstrate and walk through how to use PSH and SMO to view and change SQL Agent jobs.</p>
<p>If you recall we had previously instantiated an object to our SQL Server instance and assigned it to our $sqlinstance variable as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>$sqlinstance = New-Object `
</span></span><span style="display:flex;"><span>   -TypeName Microsoft.SQLServer.Management.Smo.Server(<span style="color:#e6db74">&#34;server2\sql2016&#34;</span>)
</span></span></code></pre></div><p>We can access the SQL Server Agent through its Jobserver property (returning an object of type <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.sqlserver.management.smo.agent.jobserver">Microsoft.SqlServer.Management.Smo.Agent.JobServer</a>). This object has lots of available properties and methods available, but the one we are interested in is clearly the Jobs property (providing a collection of type <a href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.sqlserver.management.smo.agent.jobcollection">Microsoft.SqlServer.Management.Smo.Agent.JobCollection</a>). Obviously, this means we have to iterate over each one or access a specific element through the collections indexer.</p>
<p>For now, let&rsquo;s take a look at all the jobs in the Jobs collection:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>$sqlinstance.jobserver.jobs|Select-Object -Property Name, Description
</span></span></code></pre></div><p>This results in the following&hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Name                    Description
</span></span><span style="display:flex;"><span>----                    -----------
</span></span><span style="display:flex;"><span>My Maintenance Job      No description available.
</span></span><span style="display:flex;"><span>syspolicy_purge_history No description available.
</span></span></code></pre></div><p>Through the indexer we can access our job in question using its collection numerator:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>$sqljob=$sqlinstance.jobserver.jobs[<span style="color:#ae81ff">0</span>]
</span></span></code></pre></div><p>Or via its named property:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>$sqljob=$sqlinstance.jobserver.jobs[<span style="color:#e6db74">&#39;My Maintenance Job&#39;</span>]
</span></span></code></pre></div><p>Either way, we now have an object which we can retrieve or change properties on.</p>
<p>A word of caution, it is possible for the underlying SQL instance settings to change between the time that your SMO instance object was created and now, so if you intend on changing something it is advisable to make sure you are looking at the most recent change. I fully expected that calling the Refresh method on the Jobs collection would be enough to rebuild the collection with updated properties, but this does not appear to be the case. In fact, doing this on the parent JobServer object or even the sqlinstance object does not do that either.</p>
<p>The only guaranteed way to ensure your SQL job information is accurate appears to be calling the Refresh method on a specific job itself as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>$sqljob.Refresh()
</span></span></code></pre></div><p>Querying our specific job now shows that we now have a description value (albeit misspelled!).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>$sqljob|Select-Object -Property Name, Description
</span></span></code></pre></div><p>Gives us:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>Name               Description
</span></span><span style="display:flex;"><span>----               -----------
</span></span><span style="display:flex;"><span>My Maintenance Job My descriptionz2
</span></span></code></pre></div><p>Let&rsquo;s fix that problem and change the description. Obviously, this should be a simple operation by setting the SQL job Description property:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>$sqljob.Description = <span style="color:#e6db74">&#39;My description&#39;</span>
</span></span></code></pre></div><p>Unfortunately, if we take a look at the SQL job through SSMS (feel free to right-click and refresh the Agent node first), we see that our change has not taken effect.</p>
<p><img src="/images/2018/myjob.jpg" alt="SQL Job"></p>
<p>In order to write back your change/s to the SQL Server instance you must call the objects Alter method as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-powershell" data-lang="powershell"><span style="display:flex;"><span>$sqljob.Alter()
</span></span></code></pre></div><p>And this is enough to update the SQL Job on the SQL instance!</p>
<p>This concludes what I hope was a fairly easy two-post demonstration of how to use SQL Server Management Objects and PowerShell and use them to programmatically manipulate your SQL Server instances. In this specific case we ultimately used SMO through PSH to query and manipulate a simple property on a SQL Job (the job description), however I hope you can visualize the potential for doing much more advanced operations using this method to the SQL job server and the entire SQL instance!</p>

      </article>
      
  <div class="tags pb-4 pt-2">
    
    
        <a class="badge rounded-pill text-uppercase text-bg-secondary" href="/tags/powershell/">PowerShell</a>
        <a class="badge rounded-pill text-uppercase text-bg-secondary" href="/tags/smo/">SMO</a>
        <a class="badge rounded-pill text-uppercase text-bg-secondary" href="/tags/sql/">SQL</a>
        <a class="badge rounded-pill text-uppercase text-bg-secondary" href="/tags/dotnet/">Dotnet</a>
  </div>

      <div class="row">
    <div class="col-md">
        
        <a href="https://tenbulls.co.uk/posts/2018/08/01/loading-and-using-sql-server-management-objects-in-powershell/">
            <span>previous: </span>
            <span>Loading and using SQL Server Management Objects in PowerShell</span>
        </a>
        
    </div>
    <div class="col-md text-md-end">
        
        <a href="https://tenbulls.co.uk/posts/2018/09/01/in-memory-logging-and-log-compression/">
            <span>next: </span>
            <span>In-Memory logging and log &#34;compression&#34;</span>
        </a>
        
    </div>
</div>
      
    </div>
  </div>
  <footer>
    <div class="container mt-4 pb-1">
    <p class="small opacity-75">
        Copyright Â© 2026 Mark Broadbent
        
    </p>
</div>

  </footer>

  </main>

  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>
