<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
  

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" type="image/png" href="https://tenbulls.co.uk/favicon.ico" />
<meta property="og:url" content="https://tenbulls.co.uk/posts/2011/01/10/checking-your-images-in-adhoc-updates/">
  <meta property="og:site_name" content="tenbulls blog">
  <meta property="og:title" content="Review image hex data before storing it in a database">
  <meta property="og:description" content="I really had to laugh (and not in a good way) when a request recently dropped into my lap to update a production database server with the script like the one that you will see shortly below. It is my firm belief that NO DML should ever be applied directly to production (Yes you read that right… NO DML). You might be thinking to yourself, “well that’s a bit weird, what’s the point of having the database then if you can’t even query it?” and that is a valid point. The key words in my original statement are applied directly and by that I mean querying or updating the Database via the native SQL application tools such as sqlcmd or more likely SSMS. If you are having to do so then I am betting there are usually one of the two following problems with your production system:">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2011-01-10T13:55:00+01:00">
    <meta property="article:modified_time" content="2011-01-10T13:55:00+01:00">

<title>tenbulls blog | Review image hex data before storing it in a database</title>

      <link rel="stylesheet" href="/css/main.min.9c8fd37ab394163a75f3b9f19662b76ee3aa3538a20e35f5c0abe36f677c8302.css" integrity="sha256-nI/TerOUFjp187nxlmK3buOqNTiiDjX1wKvjb2d8gwI=" crossorigin="anonymous">
        <link rel="stylesheet" href="/css/palette/default.min.98db41a18eb278705557b678b4ad23b154f0f60e0dc69d3672f24207a951505b.css" integrity="sha256-mNtBoY6yeHBVV7Z4tK0jsVTw9g4Nxp02cvJCB6lRUFs=" crossorigin="anonymous">

      <script src="/js/main.86bb3d8e6f46df0fc97c2731e6b99175a13b87a4086acf578ff9b6992fcf32c1.js" integrity="sha256-hrs9jm9G3w/JfCcx5rmRdaE7h6QIas9Xj/m2mS/PMsE=" crossorigin="anonymous"></script>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

</head>

<body
    class="dark"
>
  
  <main>
    
  <div class="container pt-5">
    <div class="row mt-5 pt-5">
      
  <nav aria-label="breadcrumb" class="small navbar navbar-expand-lg">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleMenu" aria-controls="collapsibleMenu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse mt-3 mt-md-0" id="collapsibleMenu">
      <ol class="breadcrumb fw-bold">
    <li class="breadcrumb-item my-1 my-md-0 ms-3 ms-md-0">
      <a href="/about"
        
      >about</a>
      
    </li>
    <li class="breadcrumb-item my-1 my-md-0 ms-3 ms-md-0">
      <a href="/"
        
      >home</a>
      
    </li>
    <li class="breadcrumb-item my-1 my-md-0 ms-3 ms-md-0">
      <a href="https://www.meetup.com/hybrid-virtual-group/"
        
          target="_blank" rel="noopener noreferrer"
        
      >meetup</a>
      
    </li>
    <li class="breadcrumb-item my-1 my-md-0 ms-3 ms-md-0">
      <a href="/posts"
        class="text-decoration-underline link-offset-3"
        
      >posts</a>
      
    </li>
    <li class="breadcrumb-item my-1 my-md-0 ms-3 ms-md-0">
      <a href="/tags"
        
      >tags</a>
      
    </li>
      </ol>
    </div>
  </nav>

    </div>
    <div class="post">
      <header class="mb-4">
        <h1 class="text-uppercase">Review image hex data before storing it in a database</h1>
        
        
        <div aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item small">
              
              <time datetime="2011-01-10T13:55:00&#43;01:00">January 10, 2011</time>
            </li>
            
            
            <li class="breadcrumb-item small">
              4 minutes
            </li>
          </ol>
        </div>
      </header>
      
      <article>
        <p>I really had to laugh (and not in a good way) when a request recently dropped into my lap to update a production database server with the script like the one that you will see shortly below. It is my firm belief that NO DML should ever be applied directly to production (Yes you read that right&hellip; <em>NO DML</em>). You might be thinking to yourself, <em>&ldquo;well that&rsquo;s a bit weird, what&rsquo;s the point of having the database then if you can&rsquo;t even query it?&rdquo;</em> and that is a valid point. The key words in my original statement are <em>applied directly</em> and by that I mean querying or updating the Database via the native SQL application tools such as <code>sqlcmd</code> or more likely SSMS. If you are having to do so then I am betting there are usually one of the two following problems with your production system:</p>
<ol>
<li>A buggy application requiring constant DML &ldquo;fixes&rdquo;</li>
<li>A lack of functionality in your application – such as a missing image updater</li>
</ol>
<p>The reasons that I believe performing adhoc <code>UPDATE</code>s, <code>DELETE</code>s and <code>INSERT</code>s on production are especially dangerous are numerous. In short you have to understand that a change outside of an application is <em>UNTESTED</em>, is therefore a <em>RISK</em> and should therefore be considered as something that should require <em>CHANGE CONTROL</em>. I am sorry to say that for this particular organization (lets call them ACME Corp), DML changes are not considered to be a RISK and therefore adhoc DML changes are incredibly frequent. I am betting that it is only a matter of time before a serious incident occurs due to the nature of these promotions but the real question is <em>will they even be aware of what caused a production issue when it finally does hit?</em> I think that it will be hard to detect the trigger of an incident due to the frequency, lack of testing and uncontrolled nature of these changes.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">UPDATE</span> [ImageRepository]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SET</span> [Description] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;A very important picture&#39;</span>
</span></span><span style="display:flex;"><span>,[Image] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>x89504E470D0A1A0A0000000D494844520000012C0000
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">01</span>BF08020000006DED7DCF000000017352474200AECE1CE9000000097
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">048597300000</span>B1300000B1301009A9C180000000774494D4507DB0109
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">162432</span>D5D14F92000020004944415478DA34BBC9B36ED971DDB732777
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3</span>CEF9BADB <span style="color:#75715e">--please note this HEX string has been reduced for brevity
</span></span></span><span style="display:flex;"><span><span style="color:#66d9ef">WHERE</span> ImageId <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span></code></pre></div><p>Anyway, lets move onto this particular issue in question. Above you will see a similar script to the one that was passed to me, I have truncated the image string for obvious reasons. It occurred to me <em>how do I know this is a valid image?</em>, and my immediate answer was to convert the HEX into a file and have a look. Well I thought I&rsquo;d at least try this out to prove the case in point -it is a rule of mine that in IT until you have tried something at least once then it is all just theory.</p>
<p>The first thing I needed to do this was a hexeditor, so I grabbed one from the Internet. I wasn&rsquo;t entirely sure that a copy and paste of the hex string straight into the editor would work without any further effort and it was no surprise that on my first attempt it failed. The problem was that I was starting the string from the wrong point and decided to simply skip the 0x at the start of the string. Once my paste into the editor had succeeded I attempted to save to the file system.</p>
<p><img src="/images/2011/hex_snippet.png" alt="Hex Editor"></p>
<p>So what did I find when I got there? Well not quite the picture that you see below, <em>but instead it was the electronic signature of two individuals</em>. I am sure that should those two people be aware that their signature was being sent around in an unencrypted format and to be stored in a database they would be rather concerned about the security implications of this. I have at very least raised the issue with the security compliance team. Anyway this aside, whilst these adhoc changes are performed I have proven that I have a fairly quick test to check that the image data is actually valid before I run through the <code>UPDATE</code>s and <code>INSERT</code>s of it.</p>
<p><img src="/images/2011/star_shrek.png" alt="It wasn&rsquo;t this image"></p>

      </article>
      

      <div class="row">
    <div class="col-md">
        
        <a href="https://tenbulls.co.uk/posts/2011/01/01/a-year-in-provence/">
            <span>previous: </span>
            <span>2010 in reflection</span>
        </a>
        
    </div>
    <div class="col-md text-md-end">
        
        <a href="https://tenbulls.co.uk/posts/2011/01/11/t-sql-tuesday-014-start-as-you-mean-to-go-on/">
            <span>next: </span>
            <span>Start as you mean to go on</span>
        </a>
        
    </div>
</div>
      
    </div>
  </div>
  <footer>
    <div class="container mt-4 pb-1">
    <p class="small opacity-75">
        Copyright © 2026 Mark Broadbent
        
    </p>
</div>

  </footer>

  </main>

  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>
