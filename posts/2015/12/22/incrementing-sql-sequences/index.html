<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head>
  

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" type="image/png" href="https://tenbulls.co.uk/favicon.ico" />
<meta property="og:url" content="https://tenbulls.co.uk/posts/2015/12/22/incrementing-sql-sequences/">
  <meta property="og:site_name" content="tenbulls blog">
  <meta property="og:title" content="Incrementing SQL Sequences">
  <meta property="og:description" content="Sequences were first introduced in SQL Server 2012 and are a way to improve performance in situations that would have traditionally been implemented using the column based identity property. One of the biggest downfalls of the identity property is that new values are generated on inserts meaning that they are also transactionally dependent. Sequences on the other hand are not and allow for caching and many other benefits which you can compare and contrast in this really good SQL Server Pro magazine article by Itzik titled SQL Server 2012 T-SQL at a Glance – Sequences.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2015-12-22T12:40:00+01:00">
    <meta property="article:modified_time" content="2015-12-22T12:40:00+01:00">
    <meta property="article:tag" content="Sequences">
    <meta property="article:tag" content="SQL">

<title>tenbulls blog | Incrementing SQL Sequences</title>

      <link rel="stylesheet" href="/css/main.min.9c8fd37ab394163a75f3b9f19662b76ee3aa3538a20e35f5c0abe36f677c8302.css" integrity="sha256-nI/TerOUFjp187nxlmK3buOqNTiiDjX1wKvjb2d8gwI=" crossorigin="anonymous">
        <link rel="stylesheet" href="/css/palette/default.min.98db41a18eb278705557b678b4ad23b154f0f60e0dc69d3672f24207a951505b.css" integrity="sha256-mNtBoY6yeHBVV7Z4tK0jsVTw9g4Nxp02cvJCB6lRUFs=" crossorigin="anonymous">

      <script src="/js/main.86bb3d8e6f46df0fc97c2731e6b99175a13b87a4086acf578ff9b6992fcf32c1.js" integrity="sha256-hrs9jm9G3w/JfCcx5rmRdaE7h6QIas9Xj/m2mS/PMsE=" crossorigin="anonymous"></script>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

</head>

<body
    class="dark"
>
  
  <main>
    
  <div class="container pt-5">
    <div class="row mt-5 pt-5">
      
  <nav aria-label="breadcrumb" class="small navbar navbar-expand-lg">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#collapsibleMenu" aria-controls="collapsibleMenu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse mt-3 mt-md-0" id="collapsibleMenu">
      <ol class="breadcrumb fw-bold">
    <li class="breadcrumb-item my-1 my-md-0 ms-3 ms-md-0">
      <a href="/about"
        
      >about</a>
      
    </li>
    <li class="breadcrumb-item my-1 my-md-0 ms-3 ms-md-0">
      <a href="/"
        
      >home</a>
      
    </li>
    <li class="breadcrumb-item my-1 my-md-0 ms-3 ms-md-0">
      <a href="https://www.meetup.com/hybrid-virtual-group/"
        
          target="_blank" rel="noopener noreferrer"
        
      >meetup</a>
      
    </li>
    <li class="breadcrumb-item my-1 my-md-0 ms-3 ms-md-0">
      <a href="/posts"
        class="text-decoration-underline link-offset-3"
        
      >posts</a>
      
    </li>
    <li class="breadcrumb-item my-1 my-md-0 ms-3 ms-md-0">
      <a href="/tags"
        
      >tags</a>
      
    </li>
      </ol>
    </div>
  </nav>

    </div>
    <div class="post">
      <header class="mb-4">
        <h1 class="text-uppercase">Incrementing SQL Sequences</h1>
        
        
        <div aria-label="breadcrumb">
          <ol class="breadcrumb">
            <li class="breadcrumb-item small">
              
              <time datetime="2015-12-22T12:40:00&#43;01:00">December 22, 2015</time>
            </li>
            
            
            <li class="breadcrumb-item small">
              3 minutes
            </li>
          </ol>
        </div>
      </header>
      
      <article>
        <p><a href="https://msdn.microsoft.com/en-us/library/ff878091(v=sql.110).aspx">Sequences</a> were first introduced in SQL Server 2012 and are a way to improve performance in situations that would have traditionally been implemented using the column based identity property. One of the biggest downfalls of the identity property is that new values are generated on inserts meaning that they are also transactionally dependent. Sequences on the other hand are not and allow for caching and many other benefits which you can compare and contrast in this really good SQL Server Pro magazine article by Itzik titled <a href="https://sqlmag.com/blog/sql-server-2012-t-sql-glance-sequences">SQL Server 2012 T-SQL at a Glance – Sequences</a>.</p>
<h1 id="our-situation">Our situation</h1>
<p>Recently our performance environment was undergoing load testing using pre-loaded synthetic data which (upon execution) started to result in failures from identity conflicts. It was fairly obvious that our current sequence seed values were much lower than the loaded data identities. Not so much of a problem you might think, since we can easily reseed the sequence number via the <em>Sequence Properties</em> dialog (below). Simply select the <em>Restart sequence checkbox</em> and type your new seed number into the entry box next to it and click <em>OK</em>.</p>
<p><img src="/images/2015/sequence-properties.jpg" alt="sequence properties"></p>
<p>The only problem with this approach is that our database was configured (rightly or wrongly) with approximately 250 sequences! Since we could not be sure which sequences would ultimately cause us problems we decided to increment each one by 10,000.</p>
<p>Not being someone who likes performing monotonous tasks and also recognising the fact that this task would probably need to be performed again in the future I decided to attempt to programatically solve this problem.</p>
<hr>
<h1 id="how-to-use-it">How to use it</h1>
<p><em><strong>Disclaimer:</strong> Before using the following script, please make sure you understand what you are doing and where you are doing it. The responsibility for its use and misuse is all yours!</em></p>
<p>The script below is fairly basic and generates a script to update every single sequence within your database (make sure you change context to the correct one) with a default increment of 10000 (feel free to alter as necessary). If you only want to update a range of sequences then obviously you should add a <code>WHERE</code> clause to this script and filter on whatever criteria floats your boat.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">DECLARE</span> <span style="color:#f92672">@</span>increment_sequence INT <span style="color:#f92672">=</span> <span style="color:#ae81ff">10000</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span>
</span></span><span style="display:flex;"><span>   <span style="color:#e6db74">&#39;ALTER SEQUENCE [&#39;</span> <span style="color:#f92672">+</span> <span style="color:#66d9ef">SCHEMA_NAME</span>(seq.schema_id) 
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;].[&#39;</span> <span style="color:#f92672">+</span> seq.name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;]&#39;</span>
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39; RESTART WITH &#39;</span><span style="color:#f92672">+</span> <span style="color:#66d9ef">CAST</span>(<span style="color:#66d9ef">CAST</span>(seq.start_value <span style="color:#66d9ef">AS</span> INT) 
</span></span><span style="display:flex;"><span>   <span style="color:#f92672">+</span> <span style="color:#f92672">@</span>increment_sequence <span style="color:#66d9ef">as</span> VARCHAR(<span style="color:#66d9ef">max</span>)) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">FROM</span>
</span></span><span style="display:flex;"><span>   sys.sequences <span style="color:#66d9ef">AS</span> seq
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">OUTER</span> <span style="color:#66d9ef">JOIN</span> sys.database_principals <span style="color:#66d9ef">AS</span> sseq
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ON</span>
</span></span><span style="display:flex;"><span>   sseq.principal_id <span style="color:#f92672">=</span> <span style="color:#66d9ef">ISNULL</span>(seq.principal_id, 
</span></span><span style="display:flex;"><span>   (OBJECTPROPERTY(seq.object_id, <span style="color:#e6db74">&#39;OwnerId&#39;</span>)))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span>
</span></span><span style="display:flex;"><span>   <span style="color:#66d9ef">SCHEMA_NAME</span>(seq.schema_id) <span style="color:#66d9ef">ASC</span>,
</span></span><span style="display:flex;"><span>   seq.[Name] <span style="color:#66d9ef">ASC</span>
</span></span></code></pre></div><p>It creates a script in your query results as below. Simply copy and paste this into a new query window and execute.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">ALTER</span> SEQUENCE [DB_Sequence].[LoanID] <span style="color:#66d9ef">RESTART</span> <span style="color:#66d9ef">WITH</span> <span style="color:#ae81ff">10033</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ALTER</span> SEQUENCE [DB_Sequence].[TransferID] <span style="color:#66d9ef">RESTART</span> <span style="color:#66d9ef">WITH</span> <span style="color:#ae81ff">10000</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ALTER</span> SEQUENCE [DB_Sequence].[AccountID] <span style="color:#66d9ef">RESTART</span> <span style="color:#66d9ef">WITH</span> <span style="color:#ae81ff">68719</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ALTER</span> SEQUENCE [DB_Sequence].[CustomerID] <span style="color:#66d9ef">RESTART</span> <span style="color:#66d9ef">WITH</span> <span style="color:#ae81ff">1010006</span>;
</span></span></code></pre></div><p>If you do need to update many sequences in your database I hope you find this script useful and it saves you as much time as much as it has me!</p>

      </article>
      
  <div class="tags pb-4 pt-2">
    
    
        <a class="badge rounded-pill text-uppercase text-bg-secondary" href="/tags/sequences/">Sequences</a>
        <a class="badge rounded-pill text-uppercase text-bg-secondary" href="/tags/sql/">SQL</a>
  </div>

      <div class="row">
    <div class="col-md">
        
        <a href="https://tenbulls.co.uk/posts/2015/12/18/restoring-cdc-enabled-databases/">
            <span>previous: </span>
            <span>Restoring CDC enabled databases</span>
        </a>
        
    </div>
    <div class="col-md text-md-end">
        
        <a href="https://tenbulls.co.uk/posts/2016/01/07/sql-nexus-is-alive/">
            <span>next: </span>
            <span>Announcing SQLNexus</span>
        </a>
        
    </div>
</div>
      
    </div>
  </div>
  <footer>
    <div class="container mt-4 pb-1">
    <p class="small opacity-75">
        Copyright © 2026 Mark Broadbent
        
    </p>
</div>

  </footer>

  </main>

  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>
